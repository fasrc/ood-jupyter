#!/usr/bin/env bash

# Benchmark info
echo "TIMING - Starting main script at: $(date)"

env -i CONFIG_FILE="${CONFIG_FILE}" HOME="${HOME}" PYTHONNOUSERSITE=1 bash --norc --noprofile <<"END"
. /etc/profile
# add jupyter to PATH without activating environment to avoid shell prompt modifications
export PATH="/n/netscratch/rc_admin/Everyone/ood-jupyter-venv/bin:${PATH}"

set -x
## if user instructed to source script prior to starting jupyter 
<%- unless context.envscript.blank? -%>
[ -f <%= context.envscript.to_s %> ] && source <%= context.envscript.to_s %>
<%- end -%>

## if additional modules are requested, 
<%- unless context.modules.blank? -%>
module purge
  <%- context.modules.to_s.split(",").each do |mymodule| %>
    module load <%= mymodule %>
  <%- end -%>
module list
<%- end -%>

# Benchmark info
echo "TIMING - Starting jupyter at: $(date)"
# Launch the Jupyter  Server
jupyter <%= context.jupyterlab_switch == "1" ? "lab" : "notebook" %> --config="${CONFIG_FILE}"
END
